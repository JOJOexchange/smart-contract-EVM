{"abi":[],"bytecode":{"object":"0x60566037600b82828239805160001a607314602a57634e487b7160e01b600052600060045260246000fd5b30600052607381538281f3fe73000000000000000000000000000000000000000030146080604052600080fdfea2646970667358221220ff645db3e7d9b521728ba881438e134934ac39e0d152a859a1fe4a8832fb40e964736f6c63430008090033","sourceMap":"159:1204:67:-:0;;;;;;;;;;;;;;;-1:-1:-1;;;159:1204:67;;;;;;;;;;;;;;;;;","linkReferences":{}},"deployedBytecode":{"object":"0x73000000000000000000000000000000000000000030146080604052600080fdfea2646970667358221220ff645db3e7d9b521728ba881438e134934ac39e0d152a859a1fe4a8832fb40e964736f6c63430008090033","sourceMap":"159:1204:67:-:0;;;;;;;;","linkReferences":{}},"methodIdentifiers":{},"rawMetadata":"{\"compiler\":{\"version\":\"0.8.9+commit.e5eed63a\"},\"language\":\"Solidity\",\"output\":{\"abi\":[],\"devdoc\":{\"kind\":\"dev\",\"methods\":{},\"version\":1},\"userdoc\":{\"kind\":\"user\",\"methods\":{},\"version\":1}},\"settings\":{\"compilationTarget\":{\"src/libraries/Position.sol\":\"Position\"},\"evmVersion\":\"london\",\"libraries\":{},\"metadata\":{\"bytecodeHash\":\"ipfs\"},\"optimizer\":{\"enabled\":true,\"runs\":200},\"remappings\":[\":@openzeppelin/=lib/openzeppelin-contracts/\",\":ds-test/=lib/forge-std/lib/ds-test/src/\",\":forge-std/=lib/forge-std/src/\",\":openzeppelin-contracts/=lib/openzeppelin-contracts/\"]},\"sources\":{\"src/libraries/Errors.sol\":{\"keccak256\":\"0x5be983b6123b2e77cfb611035474d747b78d9dc907f339fe833cc218fffe4483\",\"license\":\"BUSL-1.1\",\"urls\":[\"bzz-raw://d6a3ee5c6dad5e9b1d679f8746ee4c898475f24eb5c0bf3e0019abc059efd08b\",\"dweb:/ipfs/Qmdysu6PgGS6Bgm3hh3tmCsoqrPwid3iA7jivz41hvYSk3\"]},\"src/libraries/Position.sol\":{\"keccak256\":\"0x2370cf962bb62de3f38e7a7fbd2f1dc1b385ea8db2a7a74299f46414ef17abfd\",\"license\":\"BUSL-1.1\",\"urls\":[\"bzz-raw://b78188458b4f9a00ba014bc6581b7cc88ab0fe142dac10af17074f357104f29e\",\"dweb:/ipfs/QmdPQTAPQUEjw9cECcJLnGZHAN8abAh2QxMtYJyfxbYG6S\"]},\"src/libraries/Types.sol\":{\"keccak256\":\"0xe6475cf1a9e65093ae313d167011b7014cdbd6fdcf84b922317f26cfdb1b12a4\",\"license\":\"BUSL-1.1\",\"urls\":[\"bzz-raw://279e941708975cc4565f0cb403036d3f74e121444845fa97f0d4dc9eaafefd3e\",\"dweb:/ipfs/QmVh5pLcqZ2SzcGJprNg7hGh3VVqd2SFPfNZ4VMGzbkR47\"]}},\"version\":1}","metadata":{"compiler":{"version":"0.8.9+commit.e5eed63a"},"language":"Solidity","output":{"abi":[],"devdoc":{"kind":"dev","methods":{},"version":1},"userdoc":{"kind":"user","methods":{},"version":1}},"settings":{"remappings":["@openzeppelin/=lib/openzeppelin-contracts/","ds-test/=lib/forge-std/lib/ds-test/src/","forge-std/=lib/forge-std/src/","openzeppelin-contracts/=lib/openzeppelin-contracts/"],"optimizer":{"enabled":true,"runs":200},"metadata":{"bytecodeHash":"ipfs"},"compilationTarget":{"src/libraries/Position.sol":"Position"},"libraries":{}},"sources":{"src/libraries/Errors.sol":{"keccak256":"0x5be983b6123b2e77cfb611035474d747b78d9dc907f339fe833cc218fffe4483","urls":["bzz-raw://d6a3ee5c6dad5e9b1d679f8746ee4c898475f24eb5c0bf3e0019abc059efd08b","dweb:/ipfs/Qmdysu6PgGS6Bgm3hh3tmCsoqrPwid3iA7jivz41hvYSk3"],"license":"BUSL-1.1"},"src/libraries/Position.sol":{"keccak256":"0x2370cf962bb62de3f38e7a7fbd2f1dc1b385ea8db2a7a74299f46414ef17abfd","urls":["bzz-raw://b78188458b4f9a00ba014bc6581b7cc88ab0fe142dac10af17074f357104f29e","dweb:/ipfs/QmdPQTAPQUEjw9cECcJLnGZHAN8abAh2QxMtYJyfxbYG6S"],"license":"BUSL-1.1"},"src/libraries/Types.sol":{"keccak256":"0xe6475cf1a9e65093ae313d167011b7014cdbd6fdcf84b922317f26cfdb1b12a4","urls":["bzz-raw://279e941708975cc4565f0cb403036d3f74e121444845fa97f0d4dc9eaafefd3e","dweb:/ipfs/QmVh5pLcqZ2SzcGJprNg7hGh3VVqd2SFPfNZ4VMGzbkR47"],"license":"BUSL-1.1"}},"version":1},"ast":{"absolutePath":"src/libraries/Position.sol","id":54489,"exportedSymbols":{"Errors":[52288],"Position":[54488],"Types":[55316]},"nodeType":"SourceUnit","src":"78:1286:67","nodes":[{"id":54372,"nodeType":"PragmaDirective","src":"78:22:67","nodes":[],"literals":["solidity","0.8",".9"]},{"id":54373,"nodeType":"ImportDirective","src":"102:33:67","nodes":[],"absolutePath":"src/libraries/Errors.sol","file":"../libraries/Errors.sol","nameLocation":"-1:-1:-1","scope":54489,"sourceUnit":52289,"symbolAliases":[],"unitAlias":""},{"id":54374,"nodeType":"ImportDirective","src":"136:21:67","nodes":[],"absolutePath":"src/libraries/Types.sol","file":"./Types.sol","nameLocation":"-1:-1:-1","scope":54489,"sourceUnit":55317,"symbolAliases":[],"unitAlias":""},{"id":54488,"nodeType":"ContractDefinition","src":"159:1204:67","nodes":[{"id":54407,"nodeType":"FunctionDefinition","src":"337:291:67","nodes":[],"body":{"id":54406,"nodeType":"Block","src":"412:216:67","nodes":[],"statements":[{"expression":{"arguments":[{"commonType":{"typeIdentifier":"t_uint256","typeString":"uint256"},"id":54391,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"expression":{"baseExpression":{"expression":{"id":54384,"name":"state","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":54378,"src":"443:5:67","typeDescriptions":{"typeIdentifier":"t_struct$_State_$55267_storage_ptr","typeString":"struct Types.State storage pointer"}},"id":54385,"isConstant":false,"isLValue":true,"isPure":false,"lValueRequested":false,"memberName":"openPositions","nodeType":"MemberAccess","referencedDeclaration":55234,"src":"443:19:67","typeDescriptions":{"typeIdentifier":"t_mapping$_t_address_$_t_array$_t_address_$dyn_storage_$","typeString":"mapping(address => address[] storage ref)"}},"id":54387,"indexExpression":{"id":54386,"name":"trader","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":54380,"src":"463:6:67","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"isConstant":false,"isLValue":true,"isPure":false,"lValueRequested":false,"nodeType":"IndexAccess","src":"443:27:67","typeDescriptions":{"typeIdentifier":"t_array$_t_address_$dyn_storage","typeString":"address[] storage ref"}},"id":54388,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberName":"length","nodeType":"MemberAccess","src":"443:34:67","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"BinaryOperation","operator":"<","rightExpression":{"expression":{"id":54389,"name":"state","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":54378,"src":"480:5:67","typeDescriptions":{"typeIdentifier":"t_struct$_State_$55267_storage_ptr","typeString":"struct Types.State storage pointer"}},"id":54390,"isConstant":false,"isLValue":true,"isPure":false,"lValueRequested":false,"memberName":"maxPositionAmount","nodeType":"MemberAccess","referencedDeclaration":55266,"src":"480:23:67","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"src":"443:60:67","typeDescriptions":{"typeIdentifier":"t_bool","typeString":"bool"}},{"expression":{"id":54392,"name":"Errors","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":52288,"src":"517:6:67","typeDescriptions":{"typeIdentifier":"t_type$_t_contract$_Errors_$52288_$","typeString":"type(library Errors)"}},"id":54393,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberName":"POSITION_AMOUNT_REACH_UPPER_LIMIT","nodeType":"MemberAccess","referencedDeclaration":52287,"src":"517:40:67","typeDescriptions":{"typeIdentifier":"t_string_memory_ptr","typeString":"string memory"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_bool","typeString":"bool"},{"typeIdentifier":"t_string_memory_ptr","typeString":"string memory"}],"id":54383,"name":"require","nodeType":"Identifier","overloadedDeclarations":[-18,-18],"referencedDeclaration":-18,"src":"422:7:67","typeDescriptions":{"typeIdentifier":"t_function_require_pure$_t_bool_$_t_string_memory_ptr_$returns$__$","typeString":"function (bool,string memory) pure"}},"id":54394,"isConstant":false,"isLValue":false,"isPure":false,"kind":"functionCall","lValueRequested":false,"names":[],"nodeType":"FunctionCall","src":"422:145:67","tryCall":false,"typeDescriptions":{"typeIdentifier":"t_tuple$__$","typeString":"tuple()"}},"id":54395,"nodeType":"ExpressionStatement","src":"422:145:67"},{"expression":{"arguments":[{"expression":{"id":54402,"name":"msg","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":-15,"src":"610:3:67","typeDescriptions":{"typeIdentifier":"t_magic_message","typeString":"msg"}},"id":54403,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberName":"sender","nodeType":"MemberAccess","src":"610:10:67","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_address","typeString":"address"}],"expression":{"baseExpression":{"expression":{"id":54396,"name":"state","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":54378,"src":"577:5:67","typeDescriptions":{"typeIdentifier":"t_struct$_State_$55267_storage_ptr","typeString":"struct Types.State storage pointer"}},"id":54399,"isConstant":false,"isLValue":true,"isPure":false,"lValueRequested":false,"memberName":"openPositions","nodeType":"MemberAccess","referencedDeclaration":55234,"src":"577:19:67","typeDescriptions":{"typeIdentifier":"t_mapping$_t_address_$_t_array$_t_address_$dyn_storage_$","typeString":"mapping(address => address[] storage ref)"}},"id":54400,"indexExpression":{"id":54398,"name":"trader","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":54380,"src":"597:6:67","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"isConstant":false,"isLValue":true,"isPure":false,"lValueRequested":false,"nodeType":"IndexAccess","src":"577:27:67","typeDescriptions":{"typeIdentifier":"t_array$_t_address_$dyn_storage","typeString":"address[] storage ref"}},"id":54401,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberName":"push","nodeType":"MemberAccess","src":"577:32:67","typeDescriptions":{"typeIdentifier":"t_function_arraypush_nonpayable$_t_array$_t_address_$dyn_storage_ptr_$_t_address_$returns$__$bound_to$_t_array$_t_address_$dyn_storage_ptr_$","typeString":"function (address[] storage pointer,address)"}},"id":54404,"isConstant":false,"isLValue":false,"isPure":false,"kind":"functionCall","lValueRequested":false,"names":[],"nodeType":"FunctionCall","src":"577:44:67","tryCall":false,"typeDescriptions":{"typeIdentifier":"t_tuple$__$","typeString":"tuple()"}},"id":54405,"nodeType":"ExpressionStatement","src":"577:44:67"}]},"documentation":{"id":54375,"nodeType":"StructuredDocumentation","src":"230:102:67","text":"@notice add position when trade or liquidation happen\n msg.sender is the perpetual contract"},"implemented":true,"kind":"function","modifiers":[],"name":"_openPosition","nameLocation":"346:13:67","parameters":{"id":54381,"nodeType":"ParameterList","parameters":[{"constant":false,"id":54378,"mutability":"mutable","name":"state","nameLocation":"380:5:67","nodeType":"VariableDeclaration","scope":54407,"src":"360:25:67","stateVariable":false,"storageLocation":"storage","typeDescriptions":{"typeIdentifier":"t_struct$_State_$55267_storage_ptr","typeString":"struct Types.State"},"typeName":{"id":54377,"nodeType":"UserDefinedTypeName","pathNode":{"id":54376,"name":"Types.State","nodeType":"IdentifierPath","referencedDeclaration":55267,"src":"360:11:67"},"referencedDeclaration":55267,"src":"360:11:67","typeDescriptions":{"typeIdentifier":"t_struct$_State_$55267_storage_ptr","typeString":"struct Types.State"}},"visibility":"internal"},{"constant":false,"id":54380,"mutability":"mutable","name":"trader","nameLocation":"395:6:67","nodeType":"VariableDeclaration","scope":54407,"src":"387:14:67","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"},"typeName":{"id":54379,"name":"address","nodeType":"ElementaryTypeName","src":"387:7:67","stateMutability":"nonpayable","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"visibility":"internal"}],"src":"359:43:67"},"returnParameters":{"id":54382,"nodeType":"ParameterList","parameters":[],"src":"412:0:67"},"scope":54488,"stateMutability":"nonpayable","virtual":false,"visibility":"internal"},{"id":54487,"nodeType":"FunctionDefinition","src":"745:616:67","nodes":[],"body":{"id":54486,"nodeType":"Block","src":"860:501:67","nodes":[],"statements":[{"expression":{"id":54424,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftHandSide":{"baseExpression":{"expression":{"id":54418,"name":"state","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":54411,"src":"870:5:67","typeDescriptions":{"typeIdentifier":"t_struct$_State_$55267_storage_ptr","typeString":"struct Types.State storage pointer"}},"id":54421,"isConstant":false,"isLValue":true,"isPure":false,"lValueRequested":false,"memberName":"primaryCredit","nodeType":"MemberAccess","referencedDeclaration":55191,"src":"870:19:67","typeDescriptions":{"typeIdentifier":"t_mapping$_t_address_$_t_int256_$","typeString":"mapping(address => int256)"}},"id":54422,"indexExpression":{"id":54420,"name":"trader","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":54413,"src":"890:6:67","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"isConstant":false,"isLValue":true,"isPure":false,"lValueRequested":true,"nodeType":"IndexAccess","src":"870:27:67","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"nodeType":"Assignment","operator":"+=","rightHandSide":{"id":54423,"name":"pnl","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":54415,"src":"901:3:67","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"src":"870:34:67","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"id":54425,"nodeType":"ExpressionStatement","src":"870:34:67"},{"expression":{"id":54435,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftHandSide":{"baseExpression":{"baseExpression":{"expression":{"id":54426,"name":"state","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":54411,"src":"914:5:67","typeDescriptions":{"typeIdentifier":"t_struct$_State_$55267_storage_ptr","typeString":"struct Types.State storage pointer"}},"id":54431,"isConstant":false,"isLValue":true,"isPure":false,"lValueRequested":false,"memberName":"positionSerialNum","nodeType":"MemberAccess","referencedDeclaration":55240,"src":"914:23:67","typeDescriptions":{"typeIdentifier":"t_mapping$_t_address_$_t_mapping$_t_address_$_t_uint256_$_$","typeString":"mapping(address => mapping(address => uint256))"}},"id":54432,"indexExpression":{"id":54428,"name":"trader","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":54413,"src":"938:6:67","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"isConstant":false,"isLValue":true,"isPure":false,"lValueRequested":false,"nodeType":"IndexAccess","src":"914:31:67","typeDescriptions":{"typeIdentifier":"t_mapping$_t_address_$_t_uint256_$","typeString":"mapping(address => uint256)"}},"id":54433,"indexExpression":{"expression":{"id":54429,"name":"msg","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":-15,"src":"946:3:67","typeDescriptions":{"typeIdentifier":"t_magic_message","typeString":"msg"}},"id":54430,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberName":"sender","nodeType":"MemberAccess","src":"946:10:67","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"isConstant":false,"isLValue":true,"isPure":false,"lValueRequested":true,"nodeType":"IndexAccess","src":"914:43:67","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"Assignment","operator":"+=","rightHandSide":{"hexValue":"31","id":54434,"isConstant":false,"isLValue":false,"isPure":true,"kind":"number","lValueRequested":false,"nodeType":"Literal","src":"961:1:67","typeDescriptions":{"typeIdentifier":"t_rational_1_by_1","typeString":"int_const 1"},"value":"1"},"src":"914:48:67","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"id":54436,"nodeType":"ExpressionStatement","src":"914:48:67"},{"assignments":[54441],"declarations":[{"constant":false,"id":54441,"mutability":"mutable","name":"positionList","nameLocation":"991:12:67","nodeType":"VariableDeclaration","scope":54486,"src":"973:30:67","stateVariable":false,"storageLocation":"storage","typeDescriptions":{"typeIdentifier":"t_array$_t_address_$dyn_storage_ptr","typeString":"address[]"},"typeName":{"baseType":{"id":54439,"name":"address","nodeType":"ElementaryTypeName","src":"973:7:67","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"id":54440,"nodeType":"ArrayTypeName","src":"973:9:67","typeDescriptions":{"typeIdentifier":"t_array$_t_address_$dyn_storage_ptr","typeString":"address[]"}},"visibility":"internal"}],"id":54446,"initialValue":{"baseExpression":{"expression":{"id":54442,"name":"state","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":54411,"src":"1006:5:67","typeDescriptions":{"typeIdentifier":"t_struct$_State_$55267_storage_ptr","typeString":"struct Types.State storage pointer"}},"id":54443,"isConstant":false,"isLValue":true,"isPure":false,"lValueRequested":false,"memberName":"openPositions","nodeType":"MemberAccess","referencedDeclaration":55234,"src":"1006:19:67","typeDescriptions":{"typeIdentifier":"t_mapping$_t_address_$_t_array$_t_address_$dyn_storage_$","typeString":"mapping(address => address[] storage ref)"}},"id":54445,"indexExpression":{"id":54444,"name":"trader","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":54413,"src":"1026:6:67","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"isConstant":false,"isLValue":true,"isPure":false,"lValueRequested":false,"nodeType":"IndexAccess","src":"1006:27:67","typeDescriptions":{"typeIdentifier":"t_array$_t_address_$dyn_storage","typeString":"address[] storage ref"}},"nodeType":"VariableDeclarationStatement","src":"973:60:67"},{"body":{"id":54484,"nodeType":"Block","src":"1090:265:67","statements":[{"condition":{"commonType":{"typeIdentifier":"t_address","typeString":"address"},"id":54460,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"baseExpression":{"id":54455,"name":"positionList","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":54441,"src":"1108:12:67","typeDescriptions":{"typeIdentifier":"t_array$_t_address_$dyn_storage_ptr","typeString":"address[] storage pointer"}},"id":54457,"indexExpression":{"id":54456,"name":"i","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":54448,"src":"1121:1:67","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"isConstant":false,"isLValue":true,"isPure":false,"lValueRequested":false,"nodeType":"IndexAccess","src":"1108:15:67","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"nodeType":"BinaryOperation","operator":"==","rightExpression":{"expression":{"id":54458,"name":"msg","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":-15,"src":"1127:3:67","typeDescriptions":{"typeIdentifier":"t_magic_message","typeString":"msg"}},"id":54459,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberName":"sender","nodeType":"MemberAccess","src":"1127:10:67","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"src":"1108:29:67","typeDescriptions":{"typeIdentifier":"t_bool","typeString":"bool"}},"id":54479,"nodeType":"IfStatement","src":"1104:182:67","trueBody":{"id":54478,"nodeType":"Block","src":"1139:147:67","statements":[{"expression":{"id":54470,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftHandSide":{"baseExpression":{"id":54461,"name":"positionList","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":54441,"src":"1157:12:67","typeDescriptions":{"typeIdentifier":"t_array$_t_address_$dyn_storage_ptr","typeString":"address[] storage pointer"}},"id":54463,"indexExpression":{"id":54462,"name":"i","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":54448,"src":"1170:1:67","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"isConstant":false,"isLValue":true,"isPure":false,"lValueRequested":true,"nodeType":"IndexAccess","src":"1157:15:67","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"nodeType":"Assignment","operator":"=","rightHandSide":{"baseExpression":{"id":54464,"name":"positionList","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":54441,"src":"1175:12:67","typeDescriptions":{"typeIdentifier":"t_array$_t_address_$dyn_storage_ptr","typeString":"address[] storage pointer"}},"id":54469,"indexExpression":{"commonType":{"typeIdentifier":"t_uint256","typeString":"uint256"},"id":54468,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"expression":{"id":54465,"name":"positionList","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":54441,"src":"1188:12:67","typeDescriptions":{"typeIdentifier":"t_array$_t_address_$dyn_storage_ptr","typeString":"address[] storage pointer"}},"id":54466,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberName":"length","nodeType":"MemberAccess","src":"1188:19:67","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"BinaryOperation","operator":"-","rightExpression":{"hexValue":"31","id":54467,"isConstant":false,"isLValue":false,"isPure":true,"kind":"number","lValueRequested":false,"nodeType":"Literal","src":"1210:1:67","typeDescriptions":{"typeIdentifier":"t_rational_1_by_1","typeString":"int_const 1"},"value":"1"},"src":"1188:23:67","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"isConstant":false,"isLValue":true,"isPure":false,"lValueRequested":false,"nodeType":"IndexAccess","src":"1175:37:67","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"src":"1157:55:67","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"id":54471,"nodeType":"ExpressionStatement","src":"1157:55:67"},{"expression":{"arguments":[],"expression":{"argumentTypes":[],"expression":{"id":54472,"name":"positionList","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":54441,"src":"1230:12:67","typeDescriptions":{"typeIdentifier":"t_array$_t_address_$dyn_storage_ptr","typeString":"address[] storage pointer"}},"id":54474,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberName":"pop","nodeType":"MemberAccess","src":"1230:16:67","typeDescriptions":{"typeIdentifier":"t_function_arraypop_nonpayable$_t_array$_t_address_$dyn_storage_ptr_$returns$__$bound_to$_t_array$_t_address_$dyn_storage_ptr_$","typeString":"function (address[] storage pointer)"}},"id":54475,"isConstant":false,"isLValue":false,"isPure":false,"kind":"functionCall","lValueRequested":false,"names":[],"nodeType":"FunctionCall","src":"1230:18:67","tryCall":false,"typeDescriptions":{"typeIdentifier":"t_tuple$__$","typeString":"tuple()"}},"id":54476,"nodeType":"ExpressionStatement","src":"1230:18:67"},{"id":54477,"nodeType":"Break","src":"1266:5:67"}]}},{"id":54483,"nodeType":"UncheckedBlock","src":"1299:46:67","statements":[{"expression":{"id":54481,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"nodeType":"UnaryOperation","operator":"++","prefix":true,"src":"1327:3:67","subExpression":{"id":54480,"name":"i","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":54448,"src":"1329:1:67","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"id":54482,"nodeType":"ExpressionStatement","src":"1327:3:67"}]}]},"condition":{"commonType":{"typeIdentifier":"t_uint256","typeString":"uint256"},"id":54454,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"id":54451,"name":"i","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":54448,"src":"1063:1:67","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"BinaryOperation","operator":"<","rightExpression":{"expression":{"id":54452,"name":"positionList","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":54441,"src":"1067:12:67","typeDescriptions":{"typeIdentifier":"t_array$_t_address_$dyn_storage_ptr","typeString":"address[] storage pointer"}},"id":54453,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberName":"length","nodeType":"MemberAccess","src":"1067:19:67","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"src":"1063:23:67","typeDescriptions":{"typeIdentifier":"t_bool","typeString":"bool"}},"id":54485,"initializationExpression":{"assignments":[54448],"declarations":[{"constant":false,"id":54448,"mutability":"mutable","name":"i","nameLocation":"1056:1:67","nodeType":"VariableDeclaration","scope":54485,"src":"1048:9:67","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"},"typeName":{"id":54447,"name":"uint256","nodeType":"ElementaryTypeName","src":"1048:7:67","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"visibility":"internal"}],"id":54450,"initialValue":{"hexValue":"30","id":54449,"isConstant":false,"isLValue":false,"isPure":true,"kind":"number","lValueRequested":false,"nodeType":"Literal","src":"1060:1:67","typeDescriptions":{"typeIdentifier":"t_rational_0_by_1","typeString":"int_const 0"},"value":"0"},"nodeType":"VariableDeclarationStatement","src":"1048:13:67"},"nodeType":"ForStatement","src":"1043:312:67"}]},"documentation":{"id":54408,"nodeType":"StructuredDocumentation","src":"634:106:67","text":"@notice realize pnl and remove position from the registry\n msg.sender is the perpetual contract"},"implemented":true,"kind":"function","modifiers":[],"name":"_realizePnl","nameLocation":"754:11:67","parameters":{"id":54416,"nodeType":"ParameterList","parameters":[{"constant":false,"id":54411,"mutability":"mutable","name":"state","nameLocation":"795:5:67","nodeType":"VariableDeclaration","scope":54487,"src":"775:25:67","stateVariable":false,"storageLocation":"storage","typeDescriptions":{"typeIdentifier":"t_struct$_State_$55267_storage_ptr","typeString":"struct Types.State"},"typeName":{"id":54410,"nodeType":"UserDefinedTypeName","pathNode":{"id":54409,"name":"Types.State","nodeType":"IdentifierPath","referencedDeclaration":55267,"src":"775:11:67"},"referencedDeclaration":55267,"src":"775:11:67","typeDescriptions":{"typeIdentifier":"t_struct$_State_$55267_storage_ptr","typeString":"struct Types.State"}},"visibility":"internal"},{"constant":false,"id":54413,"mutability":"mutable","name":"trader","nameLocation":"818:6:67","nodeType":"VariableDeclaration","scope":54487,"src":"810:14:67","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"},"typeName":{"id":54412,"name":"address","nodeType":"ElementaryTypeName","src":"810:7:67","stateMutability":"nonpayable","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"visibility":"internal"},{"constant":false,"id":54415,"mutability":"mutable","name":"pnl","nameLocation":"841:3:67","nodeType":"VariableDeclaration","scope":54487,"src":"834:10:67","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"},"typeName":{"id":54414,"name":"int256","nodeType":"ElementaryTypeName","src":"834:6:67","typeDescriptions":{"typeIdentifier":"t_int256","typeString":"int256"}},"visibility":"internal"}],"src":"765:85:67"},"returnParameters":{"id":54417,"nodeType":"ParameterList","parameters":[],"src":"860:0:67"},"scope":54488,"stateMutability":"nonpayable","virtual":false,"visibility":"internal"}],"abstract":false,"baseContracts":[],"canonicalName":"Position","contractDependencies":[],"contractKind":"library","fullyImplemented":true,"linearizedBaseContracts":[54488],"name":"Position","nameLocation":"167:8:67","scope":54489,"usedErrors":[]}],"license":"BUSL-1.1"},"id":67}